---
title: 博客折腾小记
date: 2018/08/22 11:31:58
updated: 2018/08/22 11:31:59
categories: 博客栈
tags:
  - 主题
  - 博客
  - 字体
abbrlink: 50658b02
thumbnail: https://res.cloudinary.com/wincer/image/upload/v1534910043/blog/hacking_blog_record/cover.png
---

我在上一次换主题的时候，曾天真的以为那是最后一次折腾，我也在那时告诉自己：以后就好好写文章，别再耗费时间在这没啥价值的事情上。现在才发现不折腾对我来说其实很难做到，原因嘛，自然是新鲜感在作祟~~男人都喜新厌旧~~。所以，我又换主题了：[inside](https://github.com/elmorec/hexo-theme-inside)。

<!-- more -->

换主题难免折腾一番，尤其是这个主题完成度似乎还不是那么高，自然花的时间更久了，下文简单说说我对这个主题的魔改：

## URL 后缀

该主题本质就是一个 Angular 编写的 SPA（single page web application，单页应用程序），每次点击不同的链接只产生一个 HTTP 请求，该请求返回的是一个 `.json` 文件，包含该页面的内容，而内容在 `hexo g` 时候已经转成 HTML 格式了，这时只需通过 `innerHTML` 属性嵌入页面中即可。

这样有好处也有坏处：

- 好处：每次点击只产生一个 HTTP 请求，从而加快了访问速度
- 坏处：不利于 SEO

因为阻止页面呈现的 JavaScript 可能会对用户体验造成不好的影响，而我为此在额外方面做了补足：添加了 27 个 `<meta>` 标签，用 Google Chrome 测试 SEO 那一项拿了 89 分，应该还算不错了（拿不到满分是因为部分字体小于 16px）。

但 Angular 编写的 SPA 有一个 ~~Bug~~Feature，即在路由时会自动去掉 URL 结尾的斜线（slash），这就很尴尬了，因为我的博客 URL 是默认在结尾都有一个斜线的，比如：`posts/xxxxxx/`，我对此的解决办法是：

1. 添加一个 `canonical` 标记，指向的链接末尾都加上一个斜线；
2. 但这样并不能解决 Google Analytics 的链接地址的问题，因为 Google Analytics 分析采用的是 HTTP 协议里的 referrer，为此我修改了发送 Google Analytics 的代码：将每一个 URL 的尾部都加上了斜线

这样一来的话，斜线的问题算是解决了。（这部分也是我折腾耗时最多的部分。）

## 用户体验

- 字体

  原主题的默认字体大小是 14px，我将正文修改成了 16px，代码字体修改为了 15px，这应该会比原主题看起来舒服一点。并且我移除了主题额外加载的字体，而纯粹改用 `font-family` 来呈现。参考了[fonts.css](https://zenozeng.github.io/fonts.css/)。~~我能吞下玻璃而不伤身体。The quick brown fox jumps over the lazy dog.~~

- Service Worker

  原主题不带 Service Worker 功能，但我还是为我的博客注册了 Service Worker 功能。

- 启用[盘古之白](https://github.com/vinta/pangu.js)

  主要是为了解决中英文混排时的问题。因为研究显示，打字的时候不喜欢在中文和英文之间加空格的人，感情路都走得很辛苦，有七成的比例会在 34 岁的时候跟自己不爱的人结婚，而其余三成的人最后只能把遗产留给自己的猫。毕竟爱情跟书写都需要适时地留白。~~终于找到了我之前过得如此不得意的原因了，看来从此之后我可以走上人生巅峰了。~~

- Disqus

  原主题对 Disqus 的 identifier 和 url 识别有误，自己新增的页面会在在首部添加 `post/` 字段，比如我的 `life/` 页面会变成 `posts/lif/`，这并不是我希望的。我针对当前 URL 简单的做了一个判断，根据 URL 的不同来生成指定的 identifier。

- API

  我将原主题的 API 请求前缀改了一下，不从源站请求，因为我的网站是采用 Cloudflare 来~~减~~加速访问，但国内速度不佳，而我博客大部分用户还是国内的。而将 API 请求源放在了国内的 CDN 后，会更大的提升页面的访问速度——访问页面几乎感觉不到页面的加载时间。

## 个人喜好

相较之前的 material 主题，我去除了 `localStorage` 功能，因为现在的博客内容需要用 JavaScript 来呈现，而放入 `localStorage` 的资源取出的速度是不如直接从 Service Worker 请求的速度来的快。

同时我也移除了 lazyload-image 的功能，之前朋友告诉我说她从 RSS 阅读器阅读文章的时候没有加载图片，想了想应该是 lazyload 的 JS 没有加载所导致的，于是乎干脆去掉了，等以后有空的时候再试试 Angular 的 lazyload 是否也有这个问题。

由于该主题文章的内容是以 `innerHTML` 呈现的，故 `<script>` 标签里的内容是不会运行的，导致我的音乐插件 Aplayer 无法加载，于是我另写了一个页面专门呈现单独的音乐插件，再以 `iframe` 嵌入当前页面，算是比较完美的一个解决方案了。

## 尾巴

这篇文章一发布，预示着我博客栈的目录收录的文章也已到达两位数（10 篇），强迫症终于满足了。

最后我想说：

- 我真的再也不！想！写！前！端！了！
- 这绝对是我最后一次折腾博客！
- ~~真香！~~
