---
title: 导出QQ聊天记录
type: categories
categories: 教程
copyright: true
tags:
  - QQ
date: '2017/07/01 15:57:33'
abbrlink: 1060d444
---

## 前言

从2013年开始，手机QQ就已经不支持聊天记录的导出功能了，目的嘛，当然是为了推广超级会员（超级会员的聊天记录有2年漫游时间），作为一个“伪技术宅”，岂能屈服于腾讯的淫威之下。正好到暑假了，有时间可以钻研一下这方面了。

## 准备

我是先在网上找，自然找到了一些工具，号称可以导出记录，可惜有的不能用还有的要收费。看来还是需要自己动手。

QQ的数据库文件保存在根目录的 `data/data/com.tencent.monileqq/databases/{QQ号}.db` 下，里面不仅有聊天记录，还有所有好友和群的信息。

不幸的是，里面的数据被加密了。

<!-- more -->

另外很幸运的是，加密方式采用的伟大的“异或加密”，那么是原本的聊天记录内容和哪一串字符加密呢？这个网上基本都有提到，就是你手机的[IMEI](https://zh.wikipedia.org/wiki/IMEI)，所有手机的IMEI都是不同的，这货就相当于手机的身份证，既然知道了加密方式和密钥，那么解密自然也就不是难事了。

## 着手

先想一下，我们聊天记录想导出成什么格式发：

我的想法是：`时间--发信人--内容`这样的格式，最重要的当然是内容啦。打开数据库文件：

如下图，mr_friend_\**...**\_New 就是你与每一个好友聊天的信息，包括昵称、备注、qq号码、聊天记录等，直接查看就会发现是被加密过的。

![](https://ws1.sinaimg.cn/large/ba22af52gy1fh3iut526vj20qt0igju1.jpg)



由于QQ在手机端使用的数据库是sqlite，Python有很方便的sqlite的工具，而且Python针对字符串处理很方便，这里就采用Python来解密。

用浏览工具打开数据库，以我的数据库为例：

![](https://ws1.sinaimg.cn/large/ba22af52gy1fh3j5olc02j21120elgnv.jpg)

`msgData`保存的就是聊天记录，`selfuin`就是聊天对象的QQ号码，`time`就是发送消息的时间，既然知道了这三个就是我们想要的，那么接下来的就好办多了，解密这三个就好了。

## 解密

既然牵扯到解密，自然也就逃不掉编码和解码。尤其是`msgData`项，确实是花费了我好久才解决。具体的过程就不说了，直接上代码。

代码已托管至Gist，见[这里](https://gist.github.com/362331456a6e0417c5aa1cf3ff7be2b7.git)。